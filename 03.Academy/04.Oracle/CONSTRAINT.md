# 5. 제약 조건(constraint)

저장할 데이터에 걸리는 특수 규칙이 바로 제약 조건이다. 제약 조건은 DB에 저장될 데이터의 정합성 및 무결성 유지하기 위해 사용된다.  

- 정합성: 데이터가 제대로 들어갔는지
- 무결성: 말이 되는 데이터가 들어갔는지
  - 참조하는 부모가 없다던지
  - 있어야 할 데이터가 없다던지
  - 중복되면 안되는데 중복이 됐다던지

✏️결론:

> ✏️: 사용자가 원하는 조건의 데이터만 유지하기 위해서 특정 컬럼에 설정하는 제약으로 데이터 무결성을 지키기 위해 제한된 조건.
## 5.1. 제약 조건

제약 조건의 종류는 다음과 같다.  

|종류|설명|
|-|-|
|NOT NULL|해당 열은 값이 NULL이면 안됨|
|UNIQUE|열 중에서 값이 유일함|
|PRIMARY KEY|기본 키. 유일하고 NOT NULL임. 테이블에 하나만 지정 가능|
|FOREIGN KEY|외래 키. 다른 테이블의 열을 참조. 존재하는 값만 넣을 수 있음|
|DEFAULT|기본 값 지정|

무결성의 종류는 다음과 같다.  

|이름|설명|
|-|-|
|도메인(domain) 무결성|열에 저장되는 값이 적합한지 체크|
|개체(enitity) 무결성|기본키는 값을 가지고 있어야하고 중복도 허용하지 않음|
|참조(referential) 무결성|참조 관계에 있는 두 테이블의 값은 항상 일관된 값을 유지|
|고유(uniqueness) 무결성|중복을 허용하지 않음|
|NULL 무결성|해당 열에는 데이터가 반드시 존재해야함|

## 5.2. NOT NULL ✏️

> ✏️: 해당 `컬럼`에 <U>반드시 값이 기록되어야 하는 경우</U>에 사용하는 제약조건으로 데이터 삽입(INSERT), 수정(UPDATE) 시 NULL값을 `허용`하지 않음.
테이블 생성 시 제약 조건 지정해보자.  

```sql
-- 칼럼 레벨 제약조건
CREATE TABLE 테이블_이름(
  칼럼이름 데이터_타입 NOT NULL
);
-- 칼럼 레벨 제약조건
CREATE TABLE 테이블_이름(
  칼럼이름 데이터_타입 CONSTRAINT 제약조건_이름 NOT NULL
);
```

## 5.3. UNIQUE ✏️

> ✏️: `컬럼` 입력 값에 대해서 `중복`을 제한하는 제약조건. `컬럼` 값을 `고유 식별자`로 사용할 때 사용한다.  
```sql
-- 칼럼 레벨 제약조건
CREATE TABLE 테이블_이름(
  칼럼이름 데이터_타입 UNIQUE
);
-- 칼럼 레벨 제약조건
CREATE TABLE 테이블_이름(
  칼럼이름 데이터_타입 CONSTRAINT 제약조건_이름 UNIQUE
);
-- 테이블 레벨 제약조건
CREATE TABLE 테이블_이름(
  칼럼이름 데이터_타입,
  ...,
  CONSTRAINT 제약조건_이름 UNIQUE (칼럼이름)
);
```

## 5.4. PRIMARY KEY ✏️

> ✏️: 테이블에서 한 행의 정보를 구분하기 위한 `고유 식별자` 역할을 컬럼에 추가하는 제약조건. `NOT NULL`과 `UNIQUE` 제약 조건의 의미를 둘다 가지고 있음.
```sql
-- 칼럼 레벨 제약조건
CREATE TABLE 테이블_이름(
  칼럼이름 데이터_타입 PRIMARY KEY
);
-- 칼럼 레벨 제약조건
CREATE TABLE 테이블_이름(
  칼럼이름 데이터_타입 CONSTRAINT 제약조건_이름 PRIMARY KEY
);
-- 테이블 레벨 제약조건
CREATE TABLE 테이블_이름(
  칼럼이름 데이터_타입,
  ...,
  CONSTRAINT 제약조건_이름 PRIMARY KEY (칼럼이름)
)
```

## 5.5. FOREIGN KEY ✏️

> ✏️: `참조`된 다른 테이블이 제공하는 값만 사용할 수 있도록 `제한`하고, 두 테이블의 데이터 간의 `관계`를 형성하는 제약조건.
```sql
-- 칼럼 레벨 제약조건
CREATE TABLE 테이블_이름(
  칼럼이름 데이터타입 REFERENCES 참조할_테이블_이름(참조할_테이블의_칼럼) 삭제_정책
);
-- 칼럼 레벨 제약조건
CREATE TABLE 테이블_이름(
  칼럼이름 데이터타입 CONSTRAINT 제약_조건_이름 REFERENCES 참조할_테이블_이름(참조할_테이블의_칼럼) 삭제_정책
)
-- 테이블 레벨 제약조건
CREATE TABLE 테이블_이름(
  칼럼이름 데이터타입,
  ...,
  CONSTRAINT 제약_조건_이름 FOREIGN KEY (칼럼이름) REFERENCES 참조할_테이블_이름(참조할_테이블의_칼럼) 삭제_정책
);
```

삭제 정책은 크게 두 가지가 존재한다.✏️  
1. `ON DELETE CASCADE` : `부모 테이블`의 데이터 `삭제` 시 해당 데이터를 `참조`하고 있던 `자식 테이블`의 데이터까지 모두 `삭제`하는 옵션
2. `ON DELETE SET NULL` : `부모 테이블` 데이터 `삭제` 시 `참조`하고 있던 `자식 테이블`의 컬럼 값을 `NULL`로 변경하는 옵션


## 5.6. CHECK ✏️

> ✏️: 컬럼에 기록되는 값을 제한할 수 있는 제약조건
```sql
-- 칼럼 레벨
CREATE TABLE 테이블_이름(
  칼럼이름 데이터타입 CONSTRAINT 제약조건_이름 CHECK (조건식)
);
-- 테이블 레벨
CREATE TABLE 테이블_이름(
  칼럼이름 데이터타입,
  CONSTRAINT 제약조건_이름 CHECK (조건식)
);
```

## 5.7. DEFAULT ✏️

> 칼럼에 저장될 기본 값을 지정하는 제약조건
```sql
CREATE TABLE 테이블_이름(
  칼럼이름 데이터타입 DEFAULT 기본값
)
```
